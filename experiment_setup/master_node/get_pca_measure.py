import os, sys, pika
import numpy as np

# kill itself after timeout
os.system("Y:\\intel_measurements\\killother_cmd.bat")
current_pid                     = os.getpid()
os.system("start Y:\\intel_measurements\\killother_python.bat " + str(current_pid) )

idx                             = int(sys.argv[1])
benchmark_category              = sys.argv[2]
benchmark_number                = sys.argv[3]
running_times                   = sys.argv[4]

event_list_file         = "Y:\\intel_measurements\\amd_benign_scripts\\amd_new_event_list.txt"
command_line            = "C:\\Users\\foo\\amd_scripts\\savitor.exe "
result_path             = "C:\\Users\\foo\\Desktop\\savitor_experiments\\run_"  \
                            + str(idx) + "_" + benchmark_category + "_" \
                            + benchmark_number + "_results.txt"
result_path_dir         = "C:\\Users\\foo\\Desktop\\savitor_experiments"  

event_list              = []
readfile                = open(event_list_file)
for lines in readfile:
    event_list.append(lines.split('\n')[0])

# clear the dir
clean_directory                 = "rmdir " + result_path_dir + " /s /q"
print clean_directory
os.system(clean_directory)
os.system("mkdir " + result_path_dir)

command_line_with_event         = command_line + " -e \"" + ' '.join(event_list[idx * 6:idx * 6 + 6]) + "\""
command_line_with_event         = command_line_with_event + " -t 60 "
command_line_with_event         = command_line_with_event + "-f 1000 "
command_line_with_event         = command_line_with_event + "-o \"" + result_path + "\" "
command_line_to_run_bm          = "PCMark8Cmd.exe --" + benchmark_category + "=" \
                                    + str(benchmark_number) + " --systeminfo=off "
os.system("echo " + command_line_to_run_bm + " > " + result_path_dir + "\\run_bm.bat" )
command_line_with_event         = command_line_with_event + "-l \"" + result_path_dir + "\\run_bm.bat" + "\"" 
print command_line_with_event
os.system(command_line_with_event)

command_to_move_result     = "move " + result_path + " " + "Z:\\" + running_times + "\\"

print command_to_move_result
os.system(command_to_move_result)

kill_word_command       = "Taskkill /IM WINWORD.exe /T /F"
os.system(kill_word_command)
kill_excel_command      = "Taskkill /IM EXCEL.exe /T /F"
os.system(kill_excel_command)
kill_powerpoint_command = "Taskkill /IM POWERPNT.EXE /T /F"
os.system(kill_powerpoint_command)

